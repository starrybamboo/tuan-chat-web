name: TuanChat 自动构建与部署

on:
  push:
    branches: [ "main", "dev/Aentro" ]   # 后者是测试cd流程的分支
  workflow_dispatch:  # 允许手动触发

jobs:
  build-and-deploy:
    name: tuan-chat-web构建与部署
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4 # 将目标分支 checkout 到运行环境
      - uses: actions/setup-node@v4 # 安装 node@20
        with:
          node-version: "22"
      - run: npm install -g pnpm # 安装 PNPM
      - run: pnpm install --frozen-lockfile # 根据 lock 文件安装依赖

      - name: install
        run: pnpm install

      - name: build
        run: pnpm build

      - name: 部署到服务器
        uses: appleboy/ssh-action@master
        with:
          host: 47.119.147.6
          username: ${{ secrets.SSH_USERNAME }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          source: "./build/client"
          target: "~/www/wwwroot/tuan-chat-web-test"
          overwrite: true


