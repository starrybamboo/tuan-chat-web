# Blocksuite 文档系统 —— 业务需求说明（必须同步更新）

本文档记录 blocksuite 文档系统的**业务口径**与**需求边界**。

维护规则（强制）：
- 任何新增/调整需求，都必须在本文档追加更新（保留变更记录）
- 本文档以“业务语义”为主，不绑定具体实现细节；实现细节请看 `INTERNAL-DATA.md`

## 0. 术语（业务视角）

- **Space**：业务上的空间/剧本共创空间。所有文档以 Space 为单位管理与隔离。
- **Room**：Space 内的会话/房间。
- **绑定（bind）**：实体与文档生命周期一致（创建/删除/权限跟随）。
- **挂载（mount）/引用（reference）**：实体不拥有文档，只持有对 Space 内某个文档的引用。

## 1. 协作范围（当前阶段）

- 目标形态：**跨设备、多用户实时协作**（类似 AFFiNE/Notion 的实时编辑体验）
- Demo 阶段：
  - **不要求实现实时协作**（没有 WebSocket 协议/地址）
  - 允许先做单机/本地能力与数据结构落地

## 1.1 存储范围（当前阶段）

- Demo 阶段：**仅本地存储**（IndexedDB 等），不需要服务端持久化
- 后续如需服务端存储/同步，会另行补充协议与实现需求

## 2. 文档管理模型（核心需求）

### 2.1 Space 为单位管理文档

- 每个 Space 维护一个“文档集合”（Space 内文档可互相引用）
- Space 内文档的引用必须可被解析（至少能做到：由 docId 找到 doc）

### 2.2 绑定关系

- **Space 绑定一个文档**：作为 Space 的“描述文档”（space description）
  - 绑定含义：Space 创建时确保该文档存在；Space 删除时该文档随之删除


### 2.3 挂载/引用关系

- **Room 挂载一个文档（引用形式）**
  - Room 本身不创建/不拥有文档
  - Room 只保存“引用到 Space 内某个文档”的关系

### 2.4 Space 下可新建“独立文档”

- Space 内允许创建不绑定 Room 的独立文档
- 独立文档同样可被 Room 引用

## 3. 编辑模式

- 所有文档都支持：
  - **Page ģʽ**
  - **Edgeless ģʽ**

## 4. 历史版本与跨会话撤销（本地）

- 允许实现：
  - 本地历史版本（version history）
  - 跨会话撤销（undo across sessions）
- 约束：
  - **必须是本地能力**（服务端不提供历史/撤销栈）

当前 Demo 的实现约定（重要）：
- 先落地 **本地历史版本 + 版本回滚（restore version）**。
- “跨会话撤销”在 Demo 阶段等价于“回滚到某个历史版本”，不实现完整持久化 undo 栈。
- 如后续确需完整 undo across sessions，再补充操作日志/undo 栈持久化方案。

## 5. 未决问题（需要你后续补充/确认）

- 文档的**权限**：Space 成员权限是否影响文档读写？是否需要只读模式？
- 文档的**命名/标题**规则：独立文档是否有标题？如何生成默认标题？
- 引用能力的最低形态：
  - 仅“跳转到引用文档”
  - 还是需要“嵌入式引用块/卡片渲染”

---

## 变更记录

- 2026-01-05：初始化业务需求说明（Space 管理文档、绑定/挂载、Page+Edgeless、本地历史/跨会话撤销、Demo 不做实时协作）