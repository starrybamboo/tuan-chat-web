/* 让编辑区域填满外层容器的最小高度，并避免双边框 */
.ql-wrapper {
  min-height: 80vh; /* 使内部容器可继承外层 min-height */
}

/* 全局基准变量(可被外层覆盖)。如果你想要 10vw,这里设置 10vw;建议后面用 clamp 控制上限。 */
:root {
  /* 移动端基准:更小的字体 14-16px */
  --ql-base-size: clamp(14px, 3.5vw, 16px);
}

/* 桌面端基准:保持原有大小 18-26px */
@media (min-width: 768px) {
  :root {
    --ql-base-size: clamp(18px, 1.2vmin, 26px);
  }
}
/* Quill 会在容器内创建 .ql-container 和 .ql-editor，这里同步继承高度 */
.ql-wrapper .ql-container {
  min-height: inherit;
  border: none; /* 使用外层边框，避免双线 */
  font-size: var(--ql-base-size) !important; /* 强制覆盖 Quill 内置样式 */
}

.ql-wrapper .ql-editor {
  min-height: inherit; /* 关键:编辑区随容器伸展 */
  padding: 1.190476vw 1.428571vw; /* 20px 24px */
  line-height: 1.45; /* 回调高少许易读性 */
  font-size: var(--ql-base-size) !important;
}

/* 标题等比放大（沿用 Quill 默认比例：h1:2em, h2:1.5em, h3:1.17em）并加粗 600 */
/* 标题：提高特定性并加 !important 避免被 Quill 主题覆盖 */
.ql-wrapper .ql-editor h1,
.ql-wrapper .ql-editor h2,
.ql-wrapper .ql-editor h3 {
  font-weight: 600 !important;
  line-height: 1.15 !important;
  margin: 0.55em 0 0.4em !important;
}
.ql-wrapper .ql-editor h1 {
  font-size: calc(var(--ql-base-size) * 2) !important;
}
.ql-wrapper .ql-editor h2 {
  font-size: calc(var(--ql-base-size) * 1.5) !important;
}
.ql-wrapper .ql-editor h3 {
  font-size: calc(var(--ql-base-size) * 1.17) !important;
}

/* Debug: 临时调试字形尺寸，可给外层添加 class "ql-debug-font" 查看实际计算结果 */
.ql-debug-font .ql-editor::after {
  content: "BASE=" attr(data-base) " computed=" attr(data-computed); /* 动态脚本写入 */
  position: fixed;
  bottom: 8px;
  right: 12px;
  background: rgba(0, 0, 0, 0.6);
  color: #fff;
  font-size: 14px;
  padding: 4px 8px;
  border-radius: 4px;
  pointer-events: none;
  z-index: 9999;
}

/* 优化占位符颜色对比 */
.ql-wrapper .ql-editor.ql-blank::before {
  color: #9ca3af; /* tailwind gray-400 */
}

/* 外层相对定位容器，承载悬浮工具栏 */
.ql-outer {
  position: relative;
}

/* 行内悬浮工具栏（飞书风格精简版） */
.ql-inline-toolbar {
  position: absolute;
  transform: translateY(-50%);
  display: none;
  padding: 0.238095vw; /* 4px */
  background: #fff;
  border: none; /* 移除边框 */
  border-radius: 0.357143vw; /* 6px */
  box-shadow: 0 0.238095vw 0.595238vw rgba(0, 0, 0, 0.08); /* 0 4px 10px */
  z-index: 10;
}
.ql-inline-toolbar.visible {
  display: inline-flex;
  gap: 0.238095vw; /* 4px */
  align-items: center;
}
.ql-inline-toolbar button {
  appearance: none;
  border: none;
  background: transparent;
  padding: 0.119048vw 0.357143vw; /* 2px 6px */
  font-size: 0.714286vw; /* 12px */
  color: #374151;
  border-radius: 0.238095vw; /* 4px */
  cursor: pointer;
}
.ql-inline-toolbar button:hover {
  background: #f3f4f6; /* gray-100 */
}
.ql-inline-toolbar .sep {
  width: 0.059524vw; /* 1px */
  height: 0.952381vw; /* 16px */
  background: #e5e7eb;
  margin: 0 0.119048vw; /* 0 2px */
}

/* 工具栏上的图标按钮 */
.ql-inline-toolbar .icon-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 1.309524vw; /* 22px */
  height: 1.309524vw; /* 22px */
}

/* 下拉菜单容器（默认隐藏，仅在 .open 时显示） */
.ql-inline-menu {
  position: absolute;
  top: 100%;
  left: 0;
  margin-top: 0.357143vw; /* 6px */
  background: #fff;
  border: none; /* 移除边框 */
  border-radius: 0.357143vw; /* 6px */
  box-shadow: 0 0.47619vw 1.190476vw rgba(0, 0, 0, 0.12); /* 0 8px 20px */
  padding: 0.357143vw; /* 6px */
  display: none;
  min-width: 8.333333vw; /* 140px */
  z-index: 999; /* 确保浮层在上方 */
  overflow-y: auto;
}
.ql-inline-menu.open {
  position: absolute;
  top: 1.488095vw; /* 25px */
  left: 0;
  background: #fff;
  border: none; /* 移除边框 */
  box-shadow: 0 0.357143vw 1.071429vw rgba(0, 0, 0, 0.12); /* 0 6px 18px */
  border-radius: 0.595238vw; /* 10px */
  padding: 0.595238vw; /* 10px */
  z-index: 999; /* 确保不被编辑器内容遮挡 */
  overflow-y: auto;
  display: grid;
  grid-template-columns: repeat(6, 2.142857vw); /* 6 列，每项约 36px */
  grid-auto-rows: 2.142857vw; /* 36px */
  gap: 0.47619vw; /* 8px */
  font-weight: 400;
  max-height: 21.428571vw; /* 360px，防止超出屏幕过多 */
}
/* 空间不足时，向上展开 */
.ql-inline-menu.drop-up {
  top: auto !important;
  bottom: 1.488095vw; /* 25px */
}
/* 工具栏预览：避免 5vw 过大，使用基准的 0.4 倍做展示（可按需调整） */
.ql-inline-menu button.style-h1 {
  font-size: calc(var(--ql-base-size) * 0.4);
  font-weight: 900;
}
.ql-inline-menu button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 2.142857vw; /* 36px */
  height: 2.142857vw; /* 36px */
  background: #fff;
  border: none; /* 移除按钮边框 */
  border-radius: 0.47619vw; /* 8px */
  color: #333;
  cursor: pointer;
}
.ql-inline-menu button:hover {
  background: #f5f7fb;
}
.ql-inline-menu button.style-inline-b {
  font-weight: 700;
}
.ql-inline-menu button.style-inline-i {
  font-style: italic;
}
.ql-inline-menu button.style-inline-s {
  text-decoration: line-through;
}
.ql-inline-menu hr {
  border: none;
  background: #e9eefc;
  margin: 0.238095vw 0; /* 4px 0 */
}
/* 移除文字风格预览类在菜单中的占位，菜单改用图标 */
.ql-inline-menu .style-paragraph,
.ql-inline-menu .style-h1,
.ql-inline-menu .style-h2,
.ql-inline-menu .style-h3,
.ql-inline-menu .style-list,
.ql-inline-menu .style-code,
.ql-inline-menu .style-inline-b,
.ql-inline-menu .style-inline-i,
.ql-inline-menu .style-inline-u,
.ql-inline-menu .style-inline-s {
  font-size: 0;
}

/* 对齐样式 */
.ql-align-center {
  text-align: center;
}
.ql-align-right {
  text-align: right;
}
.ql-align-justify {
  text-align: justify;
}

/* 水平线统一样式 */
.ql-editor hr,
.ql-editor .ql-hr {
  border: none;
  border-top: 3px solid #e5e7eb;
  margin: 1.2em 0;
  height: 0;
}

/* @弹窗修饰 */
.mention-preview .preview-html h1 {
  font-size: 1.05rem;
  font-weight: 600;
  line-height: 1.2;
  margin: 0.55em 0 0.4em;
}
.mention-preview .preview-html h2 {
  font-size: 0.95rem;
  font-weight: 600;
  line-height: 1.25;
  margin: 0.55em 0 0.4em;
}
.mention-preview .preview-html h3 {
  font-size: 0.88rem;
  font-weight: 600;
  line-height: 1.3;
  margin: 0.5em 0 0.35em;
}
.mention-preview .preview-html p {
  margin: 0.45em 0;
}
.mention-preview .preview-html .ql-mention-span {
  display: inline-block;
  padding: 0 4px;
  border-radius: 4px;
  font-size: 0.75rem;
  line-height: 1.2;
  background: #eef2ff;
  color: #4338ca;
}
.mention-preview .preview-html .ql-mention-span[data-category="人物"] {
  background: #fef3c7;
  color: #92400e;
}
.mention-preview .preview-html .ql-mention-span[data-category="地点"] {
  background: #d1fae5;
  color: #065f46;
}
.mention-preview .preview-html .ql-mention-span[data-category="物品"] {
  background: #e0f2fe;
  color: #075985;
}
.mention-preview .preview-html strong {
  font-weight: 600;
}
.mention-preview .preview-html em {
  font-style: italic;
}
.mention-preview .preview-html u {
  text-decoration: underline;
}
.mention-preview .preview-html s {
  text-decoration: line-through;
}
.mention-preview .preview-html hr {
  border: none;
  border-top: 1px solid #e5e7eb;
  margin: 0.6em 0;
}

/* 通用 Markdown 展示区域（弹窗 & 外部组件复用） */
.mention-markdown {
  --mm-link-color: #2563eb;
  --mm-link-visited: #4f46e5;
  --mm-link-hover: #1d4ed8;
  --mm-list-indent-step: 1.1em;
  font-size: var(--ql-base-size); /* 使用与编辑器相同的基准字体 */
}
.mention-markdown h1,
.mention-markdown h2,
.mention-markdown h3 {
  font-weight: 600;
  line-height: 1.2;
  margin: 0.9em 0 0.5em;
}
.mention-markdown h1 {
  font-size: calc(var(--ql-base-size) * 2); /* 与编辑器保持一致 */
}
.mention-markdown h2 {
  font-size: calc(var(--ql-base-size) * 1.5); /* 与编辑器保持一致 */
}
.mention-markdown h3 {
  font-size: calc(var(--ql-base-size) * 1.17); /* 与编辑器保持一致 */
}
.mention-markdown p {
  margin: 0.6em 0;
}
.mention-markdown strong {
  font-weight: 600;
}
.mention-markdown em {
  font-style: italic;
}
.mention-markdown u {
  text-decoration: underline;
}
.mention-markdown s {
  text-decoration: line-through;
}
.mention-markdown hr {
  border: none;
  border-top: 1px solid #e5e7eb;
  margin: 1.2em 0;
}
.mention-markdown a {
  color: var(--mm-link-color);
  text-decoration: underline;
  cursor: pointer;
  word-break: break-all;
}
.mention-markdown a:visited {
  color: var(--mm-link-visited);
}
.mention-markdown a:hover {
  color: var(--mm-link-hover);
}

.mention-markdown ul {
  list-style-type: disc;
  margin: 0.75em 1.25em;
  padding-left: 1.25em;
}
.mention-markdown ol {
  list-style-type: decimal;
  margin: 0.75em 1.25em;
  padding-left: 1.25em;
}
.mention-markdown li {
  margin: 0.25em 0;
  line-height: 1.45;
}
.mention-markdown li ul,
.mention-markdown li ol {
  margin: 0.3em 0;
}

/* 多级缩进（5 级） */
.mention-markdown ul ul,
.mention-markdown ol ul,
.mention-markdown ul ol,
.mention-markdown ol ol {
  margin-left: calc(var(--mm-list-indent-step) * 1);
}
.mention-markdown ul ul ul,
.mention-markdown ol ul ul {
  margin-left: calc(var(--mm-list-indent-step) * 2);
}
.mention-markdown ul ul ul ul {
  margin-left: calc(var(--mm-list-indent-step) * 3);
}
.mention-markdown ul ul ul ul ul {
  margin-left: calc(var(--mm-list-indent-step) * 4);
}

/* .mention-preview .preview-html, .markdown-mention-viewer 仍然可手动再加 class="mention-markdown" 以获得变量覆盖能力 */

/* 在不支持 @apply 的环境（非 PostCSS Tailwind）时的后备：直接列出两个容器引用通用类的所有规则（保持冗余让构建不报错） */
.mention-preview .preview-html a,
.markdown-mention-viewer a {
  color: var(--mm-link-color);
  text-decoration: underline;
  cursor: pointer;
  word-break: break-all;
}
.mention-preview .preview-html a:visited,
.markdown-mention-viewer a:visited {
  color: var(--mm-link-visited);
}
.mention-preview .preview-html a:hover,
.markdown-mention-viewer a:hover {
  color: var(--mm-link-hover);
}
.mention-preview .preview-html ul,
.markdown-mention-viewer ul {
  list-style-type: disc;
  margin: 0.75em 1.25em;
  padding-left: 1.25em;
}
.mention-preview .preview-html ol,
.markdown-mention-viewer ol {
  list-style-type: decimal;
  margin: 0.75em 1.25em;
  padding-left: 1.25em;
}
.mention-preview .preview-html li,
.markdown-mention-viewer li {
  margin: 0.25em 0;
  line-height: 1.45;
}
.mention-preview .preview-html li ul,
.mention-preview .preview-html li ol,
.markdown-mention-viewer li ul,
.markdown-mention-viewer li ol {
  margin: 0.3em 0;
}
.mention-preview .preview-html ul ul,
.mention-preview .preview-html ol ul,
.mention-preview .preview-html ul ol,
.mention-preview .preview-html ol ol,
.markdown-mention-viewer ul ul,
.markdown-mention-viewer ol ul,
.markdown-mention-viewer ul ol,
.markdown-mention-viewer ol ol {
  margin-left: calc(var(--mm-list-indent-step) * 1);
}
.mention-preview .preview-html ul ul ul,
.mention-preview .preview-html ol ul ul,
.markdown-mention-viewer ul ul ul,
.markdown-mention-viewer ol ul ul {
  margin-left: calc(var(--mm-list-indent-step) * 2);
}
.mention-preview .preview-html ul ul ul ul,
.markdown-mention-viewer ul ul ul ul {
  margin-left: calc(var(--mm-list-indent-step) * 3);
}
.mention-preview .preview-html ul ul ul ul ul,
.markdown-mention-viewer ul ul ul ul ul {
  margin-left: calc(var(--mm-list-indent-step) * 4);
}
