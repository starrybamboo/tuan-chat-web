# 聊天室房间全功能手工测试用例汇总（GUI肉眼版）

> 目标：用于“开一个房间后，把核心功能都走一遍”的人工回归测试。
> 说明：本文件基于当前代码实现整理，重点覆盖输入/操作/预期输出与截图采集点。

## 1. 测试范围与判定

- 测试对象：`tuan-chat-web` 聊天房间 GUI 与 `TuanChat` 对应房间/消息后端行为。
- 测试方式：手工点击 + 目视比对 + 必要时查看 toast/弹窗文本。
- 通过标准：每条用例“预期输出”全部满足；截图位素材齐全；无阻断错误。

## 2. 测试账号与前置数据

- 账号A：KP（空间房主）。
- 账号B：玩家（加入空间，已在房间内）。
- 账号C：观战（memberType>=3，进入空间但不具备发言角色）。
- 建议准备：至少 2 个房间角色（含头像），1 个 NPC 角色，1~2 个可上传图片/音频/文件。

【截图位-00：测试账号列表与角色分配】

## 3. 新开空间/房间后“应该有什么”（验收清单）

### TC-01 新建空间自动带出默认房间
- 前置条件：账号A未创建该空间。
- 输入与操作：账号A在聊天页创建空间。
- 预期输出：空间创建成功后，自动出现一个名为`默认房间`的房间。
- 预期输出：房间可直接进入聊天窗口。
- 截图位：`【截图位-01：新空间内默认房间】`

### TC-02 空间默认描述与规则默认值
- 前置条件：刚创建的新空间。
- 输入与操作：进入空间资料页。
- 预期输出：空间描述默认值语义为`空间默认描述`（如未手工修改）。
- 预期输出：默认规则ID为`2`（可通过规则相关UI或接口日志核验）。
- 截图位：`【截图位-02：空间资料默认描述/规则】`

### TC-03 房间默认描述文案
- 前置条件：TC-01 的默认房间。
- 输入与操作：打开房间资料（房间描述编辑区）。
- 预期输出：默认描述语义为`场景默认描述`，历史“房间默认描述”应视为迁移后文案。
- 截图位：`【截图位-03：房间资料默认描述】`

### TC-04 直接创建新房间的默认命名
- 前置条件：已进入某空间。
- 输入与操作：创建房间时将房间名留空并提交。
- 预期输出：新房间名称默认显示为`{用户名}的房间`。
- 预期输出：若上传/填写头像为空，则默认使用当前用户头像。
- 截图位：`【截图位-04：空名称创建房间后的命名】`

### TC-05 创建房间时成员自动加入
- 前置条件：创建房间弹窗可选成员。
- 输入与操作：账号A创建房间并勾选账号B。
- 预期输出：账号A必定在房间成员内；账号B也出现在房间成员内。
- 截图位：`【截图位-05：房间成员列表含创建者与被邀请者】`

## 4. 左侧分类树与房间入口

### TC-06 新增分类
- 前置条件：账号A在空间内，左侧栏可编辑。
- 输入与操作：点击`新增分类`，输入分类名并确认。
- 预期输出：新增分类出现在列表，名称与输入一致。
- 截图位：`【截图位-06：新增分类结果】`

### TC-07 分类重命名
- 前置条件：已有至少一个分类。
- 输入与操作：分类右键`重命名`，输入新名称确认。
- 预期输出：分类标题即时更新。
- 截图位：`【截图位-07：分类重命名前后】`

### TC-08 分类删除与最小分类保护
- 前置条件：至少2个分类。
- 输入与操作：分类右键`删除分类`并确认。
- 预期输出：分类被删除，内部节点移动到相邻分类。
- 预期输出：当仅剩1个分类时，删除按钮应不可用。
- 截图位：`【截图位-08：删除分类与禁用态】`

### TC-09 分类拖拽排序
- 前置条件：至少2个分类。
- 输入与操作：拖动分类头到新位置。
- 预期输出：分类顺序变化并保持。
- 截图位：`【截图位-09：分类拖拽前后】`

### TC-10 分类内添加房间
- 前置条件：分类展开，存在未入树房间。
- 输入与操作：分类菜单`添加频道…`，选择房间并点`添加`。
- 预期输出：目标房间节点加入该分类。
- 截图位：`【截图位-10：分类内新增房间节点】`

### TC-11 KP 添加文档节点
- 前置条件：账号A（KP），分类菜单可见文档添加。
- 输入与操作：分类菜单`添加频道…`，在`添加文档…`选择文档并添加。
- 预期输出：文档节点加入分类。
- 预期输出：非KP账号看不到该文档添加入口。
- 截图位：`【截图位-11：KP与非KP添加文档入口对比】`

### TC-12 重置默认分类树
- 前置条件：分类树有手工改动。
- 输入与操作：点击`重置默认`。
- 预期输出：恢复为默认结构（频道分类，KP下额外含文档分类）。
- 截图位：`【截图位-12：重置默认前后】`

## 5. 房间顶部栏

### TC-13 导入记录入口
- 前置条件：进入房间。
- 输入与操作：点击顶部`导入记录`图标。
- 预期输出：打开导入对话窗口（可粘贴/上传文本）。
- 截图位：`【截图位-13：导入记录窗口】`

### TC-14 导出/多选入口
- 前置条件：聊天区有多条消息。
- 输入与操作：点击顶部`导出/多选`图标。
- 预期输出：进入多选态，顶部出现`已选择X条消息`工具条。
- 截图位：`【截图位-14：多选工具条】`

### TC-15 切换消息样式
- 前置条件：有若干消息。
- 输入与操作：点击顶部气泡图标（提示“切换到传统/气泡样式”）。
- 预期输出：消息展示风格在两种样式间切换。
- 截图位：`【截图位-15：两种消息样式对比】`

### TC-16 房间成员抽屉
- 前置条件：进入房间。
- 输入与操作：点击顶部`房间成员`。
- 预期输出：右侧打开成员抽屉，再次点击可关闭。
- 截图位：`【截图位-16：房间成员抽屉】`

### TC-17 房间角色抽屉
- 前置条件：进入房间。
- 输入与操作：点击顶部`房间角色`。
- 预期输出：右侧打开角色抽屉，再次点击可关闭。
- 截图位：`【截图位-17：房间角色抽屉】`

### TC-18 顶部搜索框
- 前置条件：聊天区有可检索内容。
- 输入与操作：在顶部搜索框输入关键字。
- 预期输出：搜索结果可定位到目标消息（无结果时出现空结果态）。
- 截图位：`【截图位-18：搜索命中与未命中】`

## 6. 输入区与发送链路

### TC-19 纯文本发送
- 前置条件：账号B在房间内且已选角色与立绘。
- 输入与操作：输入`你好，测试文本消息`并回车发送。
- 预期输出：消息类型为文本，气泡中展示完整文本。
- 截图位：`【截图位-19：文本消息发送结果】`

### TC-20 文本长度限制
- 前置条件：可输入文本。
- 输入与操作：粘贴超过1024字文本并发送。
- 预期输出：阻止发送并提示`消息长度不能超过 1024 字`。
- 截图位：`【截图位-20：超长文本toast】`

### TC-21 表情发送
- 前置条件：可打开表情面板。
- 输入与操作：点击表情图标，选择一张表情发送。
- 预期输出：生成图片消息（含表情图），可正常显示。
- 截图位：`【截图位-21：表情消息】`

### TC-22 图片发送
- 前置条件：本地有图片文件。
- 输入与操作：点击图片上传并发送。
- 预期输出：消息渲染为图片，显示尺寸正常，可附带文字。
- 截图位：`【截图位-22：图片消息】`

### TC-23 音频发送
- 前置条件：本地有音频文件。
- 输入与操作：点击音频上传并发送。
- 预期输出：消息显示音频播放器；可播放；可见时长/文件名信息。
- 截图位：`【截图位-23：音频消息】`

### TC-24 文件发送
- 前置条件：本地有任意文件。
- 输入与操作：通过附件或拖拽加入文件后发送。
- 预期输出：消息以`文件`标识展示文件名与大小，可点击下载/打开。
- 截图位：`【截图位-24：文件消息】`

### TC-25 AI 重写快捷键
- 前置条件：输入框有待重写文本。
- 输入与操作：按`Tab`触发重写；按`Esc`取消重写。
- 预期输出：`Tab`后出现重写结果插入能力；`Esc`提示`已取消重写`并恢复原文。
- 截图位：`【截图位-25：AI重写与取消】`

### TC-26 导入文本对话
- 前置条件：准备形如`[角色名]：内容`的文本。
- 输入与操作：打开导入窗口，完成角色映射并导入。
- 预期输出：批量消息导入成功；进度条递增；完成后提示`导入完成`。
- 截图位：`【截图位-26：导入映射与进度】`

### TC-27 @提及与检定请求入口
- 前置条件：KP账号输入框可用。
- 输入与操作：输入`@检定请求 .ra 侦查`并发送。
- 预期输出：生成`检定请求`类型消息；卡片中出现指令文本。
- 截图位：`【截图位-27：检定请求消息卡片】`

### TC-28 观战输入禁用
- 前置条件：账号C为观战。
- 输入与操作：尝试输入并发送任意消息。
- 预期输出：输入区提示观战模式不可发送；发送时toast为`您是观战，不能发送消息`。
- 截图位：`【截图位-28：观战发送限制】`

### TC-29 非KP旁白发送限制
- 前置条件：账号B切换到旁白（无角色）状态。
- 输入与操作：发送消息。
- 预期输出：发送被拦截，toast为`旁白仅KP可用，请先选择/拉入你的角色`。
- 截图位：`【截图位-29：非KP旁白限制】`

### TC-30 插入消息模式
- 前置条件：已有历史消息。
- 输入与操作：对某消息点`在此处插入消息`，再发送新消息。
- 预期输出：输入区出现“将插入到消息后”提示；新消息位置落在目标消息后。
- 截图位：`【截图位-30：插入模式提示与结果】`

## 7. 消息渲染类型覆盖与右键菜单

### TC-31 文本/黑屏文本互转
- 前置条件：KP或消息可编辑者。
- 输入与操作：对文本消息使用“转为黑屏/转为对话”。
- 预期输出：消息样式在普通文本与黑底白字之间切换。
- 截图位：`【截图位-31：黑屏文本切换】`

### TC-32 骰子消息显示
- 前置条件：可发送骰子命令。
- 输入与操作：发送骰子相关指令。
- 预期输出：消息带`骰娘`标记并显示结果文本。
- 截图位：`【截图位-32：骰子消息】`

### TC-33 特效消息显示
- 前置条件：开启WebGAL联动模式。
- 输入与操作：导演控制台发送`rain/snow/sakura/none`。
- 预期输出：消息以`特效`徽标展示效果名。
- 截图位：`【截图位-33：特效消息】`

### TC-34 WebGAL变量消息显示
- 前置条件：开启WebGAL联动；可发送变量。
- 输入与操作：发送`/var set FLAG_A=1`。
- 预期输出：出现`变量`徽标消息，正文摘要为`FLAG_A = 1`。
- 截图位：`【截图位-34：变量消息】`

### TC-35 WebGAL变量指令格式校验
- 前置条件：输入框可用。
- 输入与操作：发送`/var set 1A=1`或`/var a=1`。
- 预期输出：前端提示格式错误（如`WebGAL 变量指令格式错误`或`变量名格式不正确`）。
- 截图位：`【截图位-35：变量格式校验toast】`

### TC-36 WebGAL选择消息
- 前置条件：开启WebGAL联动。
- 输入与操作：发送选择项（choose）。
- 预期输出：消息按选择组件渲染；可见选项文本。
- 截图位：`【截图位-36：WebGAL选择消息】`

### TC-37 Command Request 执行
- 前置条件：房间内存在检定请求消息。
- 输入与操作：账号B点击检定请求按钮。
- 预期输出：在有权限时自动执行并发送对应指令消息；无权限时显示限制toast。
- 截图位：`【截图位-37：检定请求点击执行】`

### TC-38 消息右键菜单全项
- 前置条件：任意可操作消息。
- 输入与操作：右键消息。
- 预期输出：可见`打开副窗口/创建或打开子区/多选/回复/删除(有权限)/添加标注/在此处插入消息/编辑文本/添加到表情(图片)`等项。
- 截图位：`【截图位-38：消息右键菜单】`

### TC-39 文档卡片复制
- 前置条件：聊天流中有文档卡片消息。
- 输入与操作：右键文档卡片，执行`复制到我的文档`。
- 预期输出：提示成功并在“我的文档”出现副本。
- 截图位：`【截图位-39：复制到我的文档】`

### TC-40 KP复制到空间侧边栏
- 前置条件：账号A（KP），存在文档卡片消息。
- 输入与操作：右键执行`复制到空间侧边栏`。
- 预期输出：文档节点出现在空间侧边栏文档分类。
- 预期输出：非KP账号不应出现该菜单项。
- 截图位：`【截图位-40：KP复制到空间侧边栏】`

## 8. 线程（子区）与副窗口

### TC-41 创建子区
- 前置条件：主消息流存在可挂载消息。
- 输入与操作：消息上点击`创建子区`。
- 预期输出：生成THREAD_ROOT并在原消息下出现子区提示条。
- 截图位：`【截图位-41：创建子区后的提示条】`

### TC-42 打开子区并在线程内回复
- 前置条件：已有子区。
- 输入与操作：点击`打开子区`进入线程视图，发送回复。
- 预期输出：线程内可看到回复；主流不直接展开线程回复正文。
- 截图位：`【截图位-42：线程内回复】`

### TC-43 打开副窗口（Room/Thread）
- 前置条件：桌面端布局可显示副窗口。
- 输入与操作：消息右键`打开副窗口`或在副窗口中切到thread tab。
- 预期输出：右侧副窗口打开，并显示对应房间/线程内容。
- 截图位：`【截图位-43：副窗口打开状态】`

### TC-44 副窗口文档权限
- 前置条件：副窗口tab切到文档。
- 输入与操作：账号B（非KP）访问文档tab。
- 预期输出：出现`仅 KP 可查看文档`提示。
- 截图位：`【截图位-44：副窗口文档权限限制】`

## 9. WebGAL联动与跑团模式

### TC-45 WebGAL联动开关
- 前置条件：在输入区工具栏可见链路按钮。
- 输入与操作：切换联动模式开/关。
- 预期输出：开启后出现WebGAL控制Dock；关闭后Dock隐藏。
- 截图位：`【截图位-45：联动模式开关】`

### TC-46 导演控制台（特效/清背景/清立绘）
- 前置条件：联动模式开启。
- 输入与操作：依次点击`下雨/下雪/樱花/停止特效/清除背景/清除立绘`。
- 预期输出：对应消息发送成功，渲染窗口表现与操作一致。
- 截图位：`【截图位-46：导演控制台操作结果】`

### TC-47 设置变量弹窗
- 前置条件：联动模式开启，非观战。
- 输入与操作：打开`设置变量…`，输入`FLAG_TEST`和`1`并发送。
- 预期输出：变量消息发送成功；非法变量名时给出格式错误。
- 截图位：`【截图位-47：设置变量弹窗与发送】`

### TC-48 选择（choose）弹窗
- 前置条件：联动模式开启。
- 输入与操作：打开`选择`，添加至少1个选项并发送。
- 预期输出：生成WEBGAL_CHOOSE消息；空选项时提示`选项文本不能为空`。
- 截图位：`【截图位-48：选择弹窗与消息】`

### TC-49 实时渲染开关
- 前置条件：联动模式开启。
- 输入与操作：点击WebGAL图标开启/关闭实时渲染。
- 预期输出：图标状态与预览状态同步（开启时可见活跃态）。
- 截图位：`【截图位-49：实时渲染开关】`

### TC-50 跑团模式开关
- 前置条件：工具栏可见骰子图标。
- 输入与操作：切换跑团模式开/关。
- 预期输出：开启后显示`我的文档/先攻/地图`入口；关闭后相关抽屉自动收起。
- 截图位：`【截图位-50：跑团模式开关】`

### TC-51 跑团入口：我的文档
- 前置条件：跑团模式开启。
- 输入与操作：点击`我的文档`。
- 预期输出：打开文档抽屉，支持新建文档/设置标签/删除文档/拖拽文档到文件夹。
- 截图位：`【截图位-51：我的文档抽屉】`

### TC-52 跑团入口：先攻栏
- 前置条件：跑团模式开启。
- 输入与操作：点击`展示先攻表`。
- 预期输出：打开先攻抽屉。
- 截图位：`【截图位-52：先攻栏抽屉】`

### TC-53 跑团入口：地图
- 前置条件：跑团模式开启。
- 输入与操作：点击`地图`。
- 预期输出：打开地图面板，可见地图区域组件。
- 截图位：`【截图位-53：地图面板】`

## 10. 多选后的导出/转发/筛选

### TC-54 正则筛选
- 前置条件：多选模式已选若干消息。
- 输入与操作：点击`筛选`，输入正则并应用。
- 预期输出：命中时提示已过滤数量；正则非法时给出错误提示。
- 截图位：`【截图位-54：正则筛选窗口】`

### TC-55 导出成文件与生成图片
- 前置条件：多选模式有选中消息。
- 输入与操作：分别点击`导出成文件`和`生成图片`并完成导出。
- 预期输出：导出窗口打开并可完成导出；关闭后可退出多选。
- 截图位：`【截图位-55：导出文件/图片】`

### TC-56 转发消息（合并/逐条）
- 前置条件：多选模式有选中消息。
- 输入与操作：点击`转发`，分别测试`合并转发`与`逐条转发`。
- 预期输出：合并模式生成1条转发消息；逐条模式按顺序发送多条。
- 截图位：`【截图位-56：转发模式与结果】`

## 11. 负向与边界用例

### TC-57 正在提交中重复发送
- 前置条件：触发一个较慢上传（大文件/音频）。
- 输入与操作：提交期间重复点发送。
- 预期输出：提示`正在提交中，请稍后`（或等价文案），不会重复发多条。
- 截图位：`【截图位-57：提交中重复发送拦截】`

### TC-58 WebGAL选择空选项
- 前置条件：打开选择弹窗。
- 输入与操作：保留空选项直接提交。
- 预期输出：提示`选项文本不能为空`。
- 截图位：`【截图位-58：空选项校验】`

### TC-59 文档跨空间复制限制
- 前置条件：准备来自其他空间的文档引用。
- 输入与操作：尝试复制到当前空间文档。
- 预期输出：提示`不允许跨空间复制文档`。
- 截图位：`【截图位-59：跨空间复制限制】`

### TC-60 子区创建缺失父消息保护
- 前置条件：模拟异常场景（目标消息不可用）。
- 输入与操作：触发创建子区。
- 预期输出：前端提示`未找到 roomId，无法创建子区`或后端报错提示；不应静默失败。
- 截图位：`【截图位-60：子区创建异常提示】`

## 12. 最小回归路线（10~15分钟）

1. 创建新空间并确认自动出现`默认房间`。
2. 进入默认房间，确认可正常发送文本。
3. 上传图片并发送，确认消息渲染正确。
4. 发送音频或文件，确认消息渲染正确。
5. 打开`房间成员`与`房间角色`抽屉。
6. 切换消息样式（气泡/传统）。
7. 右键一条消息，走`回复`与`在此处插入消息`。
8. 创建一个子区并在线程里发送1条回复。
9. 开启WebGAL联动，发送1条特效或变量消息。
10. 开启跑团模式，打开`我的文档`与`地图`。
11. 进入多选，执行`导出成文件`或`转发`。
12. 用观战账号尝试发送，确认被限制。

## 13. 全量执行记录模板（可复制）

- 执行人：
- 执行日期：
- 客户端版本：
- 后端版本：
- 空间ID：
- 房间ID：
- 结果统计：通过 __ / 失败 __ / 阻塞 __
- 失败明细：
- 截图清单：`截图位-00` ~ `截图位-60`

## 14. 依据代码（便于追溯）

- 前端房间主结构：`tuan-chat-web/app/components/chat/room/roomWindowLayout.tsx`
- 顶部栏按钮：`tuan-chat-web/app/components/chat/room/roomHeaderBar.tsx`
- 发送区与权限校验：`tuan-chat-web/app/components/chat/room/useChatMessageSubmit.ts`
- WebGAL变量解析：`tuan-chat-web/app/types/webgalVar.ts`
- 跑团/WebGAL工具栏：`tuan-chat-web/app/components/chat/input/chatToolbar.tsx`
- 导演/跑团Dock：`tuan-chat-web/app/components/chat/input/chatToolbarDock.tsx`
- 右键菜单：`tuan-chat-web/app/components/chat/room/contextMenu/chatFrameContextMenu.tsx`
- 消息渲染类型：`tuan-chat-web/app/components/chat/message/chatBubble.tsx`
- 子区聚合逻辑：`tuan-chat-web/app/components/chat/hooks/useChatFrameMessages.ts`
- 左侧分类树与重置默认：`tuan-chat-web/app/components/chat/room/sidebarTree.ts`
- 分类/文档侧栏GUI：`tuan-chat-web/app/components/chat/room/chatRoomListPanel.tsx`
- 后端空间创建默认房间：`TuanChat/src/main/java/com/jxc/tuanchat/room/service/SpaceService.java`
- 后端房间创建默认命名：`TuanChat/src/main/java/com/jxc/tuanchat/room/service/RoomService.java`
- 后端消息类型：`TuanChat/src/main/java/com/jxc/tuanchat/chat/enums/MessageTypeEnum.java`
- 后端消息内容长度限制：`TuanChat/src/main/java/com/jxc/tuanchat/chat/domain/request/message/ChatMessageRequest.java`
- 后端WebGAL变量约束：`TuanChat/src/main/java/com/jxc/tuanchat/chat/domain/entity/message/WebgalVarPayload.java`
- 默认描述迁移SQL：`TuanChat/src/main/resources/sql/room_default_description_to_scene_default_description.sql`
