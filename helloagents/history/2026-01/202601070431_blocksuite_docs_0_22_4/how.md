# 技术设计: Blocksuite 0.22.4 文档入库（可直接用于本项目）

## 技术方案

### 核心技术
- React 19 + TypeScript（本项目技术栈）
- Blocksuite `@blocksuite/*@0.22.4`（以 `package.json` + 实际 `node_modules` 为准）

### 实现要点
- 以 **安装内容为唯一事实来源**：从 `node_modules/@blocksuite/*/package.json` 的 `exports`（subpath exports）与入口文件（`src/index.ts` 等）提取“对外可用入口”。
- 以 **本项目使用点** 作为文档优先级排序：扫描 `app/` 中 `@blocksuite/*` 的 import，先覆盖实际用到的入口与能力。
- 文档分两层：
  1. **包级文档**：每个包是什么、提供哪些入口、常见用途、关键概念、在本项目哪里用到。
  2. **场景文档**：围绕“嵌入编辑器/协同同步/块渲染/导入导出”给出可落地的 TS 示例与注意事项。

## 架构决策 ADR

### ADR-001: 以 subpath exports 为“文档目录结构”的主线
**上下文:** Blocksuite 采用大量 subpath exports（尤其 `@blocksuite/affine`），直接按源码文件逐个说明会导致文档无法维护。  
**决策:** 文档以 `package.json#exports` 的入口（subpath）为主线，按用途分组；对入口对应的关键类型/函数再做展开。  
**理由:** `exports` 是对外稳定契约，比源码文件更贴近“怎么用”。  
**替代方案:** 逐文件说明 → 拒绝原因: 维护成本不可控、读者无法快速定位“可用入口”。  
**影响:** 文档更贴近使用者视角，但需要在“入口→源码”之间提供追溯路径（文件路径/关键符号名）。

## 安全与性能

- **安全:** 仅写入知识库 Markdown，不引入密钥/令牌/生产地址；示例中涉及 WS/存储时用占位符与本地 mock 说明。
- **性能:** 文档侧不引入运行时代码；仅在需要时提供“最小可用示例”，避免鼓励直接复制大段上游实现。

## 测试与验证

- 文档一致性校验：
  - 入口校验：文档中列出的 import 路径必须存在于 `@blocksuite/*@0.22.4` 的 `exports`。
  - 使用点校验：文档引用的本项目文件路径必须存在。
- 项目回归（可选）：执行 `pnpm typecheck`（文档本身不影响编译，但用于确认过程中未误改代码/配置）。
