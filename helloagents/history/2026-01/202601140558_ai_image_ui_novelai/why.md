# 变更提案: AI 生图（/ai-image）UI 重构，对齐 NovelAI Image Generation

## 需求背景

现有 `/ai-image` 页面功能已覆盖 Web/Electron 出图、img2img、历史与下载，但页面布局更偏“调试面板”，与 NovelAI 官方 `https://novelai.net/image` 的操作逻辑与视觉结构差异较大。

用户希望“照着做全部”，即尽量对齐 NovelAI Image Generation 页的交互分区与样式风格，在不引入新 UI 框架（继续 Tailwind + DaisyUI）且不破坏现有出图能力的前提下提升可用性与一致性。

## 产品分析

### 目标用户与场景
- **用户群体:** 需要快速试验提示词/参数组合的创作者与开发/测试人员
- **使用场景:** 在 `/ai-image` 进行文生图/图生图，按 NovelAI 的习惯流程操作并复用既有经验
- **核心痛点:** 现有 UI 信息结构与 NovelAI 官方页面不一致，上手成本高；参数/历史/输出分区不够贴近主流工作流

### 价值主张与成功指标
- **价值主张:** UI/交互尽量贴近 NovelAI 官方 Image 页面，使用户在本地（Web/Electron）获得一致的操作体验
- **成功指标:**
  - 页面结构与常用操作路径接近 NovelAI（Prompt/Undesired/图像设置/生成/输出/历史）
  - 保持现有功能（txt2img/img2img、历史、下载、Web/Electron 出图）不回退
  - 响应式布局可用（窄屏不崩、关键操作可达）

### 人文关怀
保持“不持久化保存 token”的原则；历史记录默认本地存储，可一键清空，避免无意长期保留敏感内容。

## 变更内容
1. 重构 `/ai-image` 页面布局与组件层级：对齐 NovelAI Image 的信息架构（分区/折叠/控件密度）。
2. 统一交互：提供与 NovelAI 类似的“生成按钮、参数区、提示词区、输出预览、历史区”等主要操作路径。
3. 保持现有请求与能力：不改 NovelAI 请求链路，仅做 UI/交互与前端结构调整。

## 影响范围
- **模块:** 前端路由页 `app/routes/aiImage.tsx`
- **文件:** `app/routes/aiImage.tsx`（可能新增少量局部组件文件，尽量控制改动范围）
- **API:** 无新增/变更
- **数据:** 继续使用现有 IndexedDB 历史存储

## 核心场景

### 需求: 操作逻辑与样式接近 NovelAI
**模块:** /ai-image

#### 场景: 文生图（txt2img）生成并查看结果
- 预期结果: Prompt/Undesired 内容可编辑；图像设置/采样器/步数/Guidance 等在统一的设置面板可调；点击 Generate 后输出预览即时可见

#### 场景: 图生图（img2img）上传图片并生成
- 预期结果: 可上传源图、调整 strength/noise；生成结果展示一致；历史可查看与下载

## 风险评估
- **风险:** 纯 UI 重构可能引入状态/交互回归（按钮不可达、字段被隐藏、移动端布局溢出）
- **缓解:** 保持 state 与生成逻辑不动为主，优先只重排 UI；引入最小组件抽取；以 `pnpm typecheck` 与基础手动验证作为门槛

