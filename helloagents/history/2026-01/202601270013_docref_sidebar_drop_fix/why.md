# 变更提案: 修复文档拖拽到侧边栏无响应

## 需求背景
当前在 Chat 中将“文档消息/文档卡片”拖拽到空间侧边栏（SidebarTree）并松手后，出现无任何反馈的问题：无网络请求、无侧边栏新增节点、无 toast 提示，导致用户无法判断是操作失败还是权限/数据不满足。

## 变更内容
1. 增强 DocRef 拖拽数据的写入与识别兼容性（不同浏览器/环境下 `DataTransfer.types` 不稳定时仍可识别）。
2. 调整 SidebarTree 的 dragover/drop 处理：确保 drop 可触发，并在无权限/数据异常时给出明确 toast 提示；在满足条件时执行“复制到空间侧边栏”的网络请求与本地树更新。

## 影响范围
- **模块:**
  - Chat（侧边栏树、文档卡片拖拽引用）
- **文件:**
  - `app/components/chat/utils/docRef.ts`
  - `app/components/chat/room/chatRoomListPanel.tsx`
- **API:**
  - `copyDocToSpaceDoc`（既有调用链，期望能稳定触发）
- **数据:**
  - 无（仅前端拖拽数据与 UI 状态）

## 核心场景

### 需求: 文档拖拽复制到空间侧边栏
**模块:** Chat
将文档卡片复制到空间侧边栏分类下，便于快速访问。

#### 场景: KP 拖拽复制成功
在已选择空间且为 KP 的情况下，将文档卡片拖拽到侧边栏任意分类并松手。
- 侧边栏出现“正在复制…”toast，成功后提示“已复制到空间侧边栏”
- 触发复制相关网络请求
- 目标分类下新增 doc 节点（指向复制后新 docId）

#### 场景: 非 KP 拖拽得到明确反馈
在已选择空间但非 KP 的情况下，将文档卡片拖拽到侧边栏并松手。
- 出现 toast 提示“仅KP可复制到空间侧边栏”
- 不触发复制网络请求

#### 场景: 拖拽数据不完整/不支持类型
拖拽内容不是空间文档，或 drag 数据未被识别。
- 出现 toast 提示（如“未识别到文档拖拽数据…”或“仅支持复制空间文档（描述文档/我的文档）”）
- 不触发复制网络请求

## 风险评估
- **风险:** 侧边栏内部“分类/节点排序”拖拽依赖 `text/plain`，若覆写可能破坏现有排序/移动行为。
  - **缓解:** 仅在 `text/plain` 为空时写入 DocRef 的兜底前缀，不覆写现有值。
- **风险:** dragover 无条件 `preventDefault` 可能影响其他类型拖拽（如 Files）。
  - **缓解:** 仅在识别为 DocRef 或 `types` 不可靠但可读取到 DocRef payload 时启用；并显式排除 Files。
