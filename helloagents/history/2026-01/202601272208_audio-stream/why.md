# 变更提案: 音频流式播放与进度条

## 需求背景
当前聊天音频消息使用 WaveSurfer/WebAudio 波形渲染，会等待音频完整下载并解码后再播放，无法满足“边播边加载”的体验要求。BGM 播放需要确保使用流式加载，不阻塞播放。

## 变更内容
1. 音频消息播放改为 HTML5 流式播放组件，移除波形展示，提供可拖动进度条与时长显示。
2. BGM 播放统一采用 Media Element 的流式加载配置（预加载 metadata），保留现有音量增益策略。
3. 清理 WaveSurfer 相关依赖与逻辑，降低包体与内存占用。

## 影响范围
- **模块:** chat
- **文件:** `app/components/chat/message/media/AudioMessage.tsx`，`app/components/chat/infra/bgm/bgmPlayer.ts`，`package.json`/`pnpm-lock.yaml`
- **API:** 无
- **数据:** 无

## 核心场景

### 需求: 音频消息流式播放
**模块:** chat
聊天消息中的音频需支持边播边加载，提供进度条与拖动定位。

#### 场景: 立即播放与拖动进度 <a id="需求-音频消息流式播放-场景-立即播放与拖动进度"></a>
前置条件:
- 消息包含可访问的音频 URL。
- 用户点击播放。

- 预期结果:
  - 未完成下载即可开始播放。
  - 展示播放进度与总时长。
  - 拖动进度条可跳转播放位置。

### 需求: BGM 流式播放
**模块:** chat
BGM 播放在网络不稳定或大文件时仍应边播边加载。

#### 场景: 房间收到 BGM <a id="需求-BGM-流式播放-场景-房间收到-BGM"></a>
前置条件:
- 房间收到 BGM url 并触发播放。

- 预期结果:
  - 不等待完整下载即可开始播放。
  - 播放过程中持续加载音频数据。

## 风险评估
- **风险:** MinIO 或中间层未启用 Range/分片响应，可能导致无法真正流式播放。
- **缓解:** 通过浏览器网络面板验证 `Accept-Ranges`/`206` 行为；必要时与后端确认配置或提供替代方案。
