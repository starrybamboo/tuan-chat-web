# 技术设计: 全局音频悬浮球与播放聚合

## 技术方案

### 核心技术
- React + 全局 store（轻量状态容器）
- 播放器注册 hook：将 HTMLMediaElement / 第三方播放器事件统一映射为“正在播放条目”

### 实现要点
- 设计“播放条目”数据结构（id、title、source、url、控制函数等）。
- 在各播放器组件中使用统一 hook 注册：
  - 播放时上报为 playing
  - 暂停/结束时更新状态并在结束后清理
- BGM 维持既有单例播放逻辑，通过桥接组件把“正在播放的 BGM”注册进全局聚合。
- 全局悬浮球挂载在 `app/root.tsx`，避免房间级组件卸载导致状态丢失。

## 安全与性能

- 不对音频内容做额外抓取/预加载，悬浮球仅展示与控制当前播放器实例
- store 仅保存必要元数据与控制回调，避免持久化敏感信息

## 测试与部署

- 定向 ESLint 检查涉及文件，确保 hooks 依赖与调用顺序正确
- 手工验证：同时播放多个音频消息 + BGM，悬浮球数量与列表实时更新，且“暂停/停止”可生效

